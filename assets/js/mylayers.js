var mylayers = ["2015","2017"].map(year => ([

      {
        type:'step',
        expression :  ['/',['to-number',['get',`ind_snv_${year}`]],['to-number',['get', `ind_${year}`]]],
        cols : colorbrewer["RdBu"][8],
        name:"snv",
        denom:"ind",
        year:year,
        visibility:'visible',
        text:`Niveau de vie moyen`,
        unit:'k €',
        format:function(d){return Math.round(d/1000)},
        group:"eco"
      },
      {
      type: 'step',
      expression :  ['*',['/',['to-number',['get',`ind_${year}`]],['get', 'area']],1000000],
      cols : colorbrewer["YlOrRd"][8],
      name:"ind",
      denom:"area",
      year :year,
      visibility:'visible',
      text:`Densité de population`,
      unit:"Hab/Km<span class='sup'>2</span>",
      format:function(d){return Math.round(d)},
      group:'pop'
    },
    {
      type: 'step',
      expression :  ['/',['to-number',['get',`men_pauv_${year}`]],['to-number',['get', `men_${year}`]]],
      name:"pauv",
      denom:"men",
      year :year,
      cols: colorbrewer["RdGy"][8],
      visibility:'visible',
      text:`Ménages pauvre`,
      unit:"%",
      format:function(d){return Math.round(d*100)},
      group:'eco'
    },
      {
        type : 'step', 
        expression:['/',['to-number',['get', `men_fmp_${year}`]],['to-number',['get',`men_${year}`]]],
        cols : colorbrewer["RdGy"][8],
        name:"fmp",
        denom:"men",
        year:year,
        visibility:'visible',
        text:`Familles monoparentales`,
        unit:"%",
        format:function(d){return Math.round(d*100)},
        group:'pop'
      },
      {
        type : 'step', 
        expression:['/',['to-number',['get', `men_5ind_${year}`]],['to-number',['get',`men_${year}`]]],
        cols : colorbrewer["RdGy"][8],
        name:"5ind",
        denom:"men",
        year:year,
        visibility:'visible',
        text:`Ménages de 5 individus ou plus`,
        unit:"%",
        format:function(d){return Math.round(d*100)},
        group:'pop'
      },
      {
        type : 'step', 
        expression:['/',['to-number',['get', `men_1ind_${year}`]],['to-number',['get',`men_${year}`]]],
        cols : colorbrewer["RdGy"][8],
        name:"1ind",
        denom:"men",
        year:year,
        visibility:'visible',
        text:`Ménages de 1 individus`,
        unit:"%",
        format:function(d){return Math.round(d*100)},
        group:'pop'
      },
  {
      type: 'step',
      expression :  ['/',['to-number',['get',`men_prop_${year}`]],['to-number',['get', `men_${year}`]]],
      name:"prop",
      denom:"men",
      year :year,
      cols: colorbrewer["Purples"][8],
      visibility:'visible',
      text:`Ménages propriétaires`,
      unit:"%",
      format:function(d){return Math.round(d*100)},
      group:'log'
    },
  {
      type: 'step',
      expression :  ['/',['to-number',['get',`men_coll_${year}`]],['to-number',['get', `men_${year}`]]],
      name:"coll",
      denom:"men",
      year :year,
      cols: colorbrewer["Purples"][8],
      visibility:'visible',
      text:`Ménages en logement collectifs`,
      unit:"%",
      format:function(d){return Math.round(d*100)},
      group:'log'
    },
    {
      type: 'step',
      expression :  ['/',['to-number',['get',`men_mais_${year}`]],['to-number',['get', `men_${year}`]]],
      name:"mais",
      denom:"men",
      year :year,
      cols: colorbrewer["Purples"][8],
      visibility:'visible',
      text:`Ménages en maison individuelle`,
      unit:"%",
      format:function(d){return Math.round(d*100)},
      group:'log'
    },
    {
      type: 'step',
      expression :  ['/',['to-number',['get',`log_soc_${year}`]],['to-number',['get', `men_${year}`]]],
      name:"soc",
      denom:"log",
      year :year,
      cols: colorbrewer["Purples"][8],
      visibility:'visible',
      text:`Ménages en logement social`,
      unit:"%",
      format:function(d){return Math.round(d*100)},
      group:'log'
    },
    {
      type: 'step',
      expression :  ['/',['to-number',['get',`men_surf_${year}`]],['to-number',['get', `men_${year}`]]],
      name:"surf",
      denom:"men",
      year :year,
      cols: colorbrewer["YlGn"][8],
      visibility:'visible',
      text:`Surface moyenne des logements`,
      unit:"m2",
      format:function(d){return Math.round(d)},
      group:'log'
    },

    {
      type: 'step',
      expression :  ['/',['to-number',['get',`log_av45_${year}`]],['to-number',['get', `men_${year}`]]],
      name:"av45",
      denom:"log",
      year :year,
      cols: colorbrewer["BrBG"][8],
      visibility:'visible',
      text:`Logements construits avant 1945`,
      unit:"%",
      format:function(d){return Math.round(d*100)},
      group:'log'
    },
    {
      type: 'step',
      expression :  ['/',['to-number',['get',`log_45_70_${year}`]],['to-number',['get', `men_${year}`]]],
      name:"45_70",
      denom:"log",
      year :year,
      cols: colorbrewer["BrBG"][8],
      visibility:'visible',
      text:`Logements construits entre 1945 et 1970`,
      unit:"%",
      format:function(d){return Math.round(d*100)},
      group:'log'
    },
    {
      type: 'step',
      expression :  ['/',['to-number',['get',`log_70_90_${year}`]],['to-number',['get', `men_${year}`]]],
      name:"70_90",
      denom:"log",
      year :year,
      cols: colorbrewer["BrBG"][8],
      visibility:'visible',
      text:`Logements construits entre 1970 et 1990`,
      unit:"%",
      format:function(d){return Math.round(d*100)},
      group:'log'
    },

    {
      type: 'step',
      expression :  ['/',['to-number',['get',`log_ap90_${year}`]],['to-number',['get', `men_${year}`]]],
      name:"ap90",
      denom:"log",
      year :year,
      cols: colorbrewer["BrBG"][8],
      visibility:'visible',
      text:`Logements construits après 1990`,
      unit:"%",
      format:function(d){return Math.round(d*100)},
      group:'log'
    },
      {
        type : 'step',
        expression: ['/',['to-number',['get',`ind_0_3_${year}`]],['to-number',['get', `ind_${year}`]]],
        cols : colorbrewer["PiYG"][8],
        name:"0_3",
        denom:"ind",
        year:year,
        visibility:'visible',
        text:`0 - 3 ans`,
        unit:"%",
        format:function(d){return Math.round(d*1000)/10},
        group:'pop'
      },
      {
        type : 'step',
        expression: ['/',['to-number',['get',`ind_4_5_${year}`]],['to-number',['get', `ind_${year}`]]],
        cols : colorbrewer["PiYG"][8],
        name:"4_5",
        denom:"ind",
        year:year,
        visibility:'visible',
        text:`4 - 5 ans`,
        unit:"%",
        format:function(d){return Math.round(d*1000)/10},
        group:'pop'
      },
      {
        type : 'step',
        expression: ['/',['to-number',['get',`ind_6_10_${year}`]],['to-number',['get', `ind_${year}`]]],
        cols : colorbrewer["PiYG"][8],
        name:"6_10",
        denom:"ind",
        year:year,
        visibility:'visible',
        text:`6 - 10 ans`,
        unit:"%",
        format:function(d){return Math.round(d*1000)/10},
        group:'pop'
      },
      {
        type : 'step',
        expression: ['/',['to-number',['get',`ind_11_17_${year}`]],['to-number',['get', `ind_${year}`]]],
        cols : colorbrewer["PiYG"][8],
        name:"11_17",
        denom:"ind",
        year:year,
        visibility:'visible',
        text:`11 - 17 ans`,
        unit:"%",
        format:function(d){return Math.round(d*1000)/10},
        group:'pop'
      },
          {
        type : 'step',
        expression: ['/',['to-number',['get',`ind_18_24_${year}`]],['to-number',['get', `ind_${year}`]]],
        cols : colorbrewer["PRGn"][8],
        name:"18_24",
        denom:"ind",
        year:year,
        visibility:'visible',
        text:'18 - 24 ans',
        unit:"%",
        format:function(d){return Math.round(d*1000)/10},
        group:'pop'
      },

          {
        type : 'step',
        expression: ['/',['to-number',['get',`ind_25_39_${year}`]],['to-number',['get', `ind_${year}`]]],
        cols : colorbrewer["PRGn"][8],
        name:"25_39",
        denom:"ind",
        year:year,
        visibility:'visible',
        text:'25 - 39 ans',
        unit:"%",
        format:function(d){return Math.round(d*1000)/10},
        group:'pop'
      },
              {
        type : 'step',
        expression: ['/',['to-number',['get',`ind_40_54_${year}`]],['to-number',['get', `ind_${year}`]]],
        cols : colorbrewer["PRGn"][8],
        name:"40_54",
        denom:"ind",
        year:year,
        visibility:'visible',
        text:'40 - 54 ans',
        unit:"%",
        format:function(d){return Math.round(d*1000)/10},
        group:'pop'
      },
              {
        type : 'step',
        expression: ['/',['to-number',['get',`ind_55_64_${year}`]],['to-number',['get', `ind_${year}`]]],
        cols : colorbrewer["PRGn"][8],
        name:"55_64",
        denom:"ind",
        year:year,
        visibility:'visible',
        text:'55 - 64 ans',
        unit:"%",
        format:function(d){return Math.round(d*1000)/10},
        group:'pop'
      },
                    {
        type : 'step',
        expression: ['/',['to-number',['get',`ind_65_79_${year}`]],['to-number',['get', `ind_${year}`]]],
        cols : colorbrewer["PuOr"][8],
        name:"65_79",
        denom:"ind",
        year:year,
        visibility:'visible',
        text:'65 - 79 ans',
        unit:"%",
        format:function(d){return Math.round(d*1000)/10},
        group:'pop'
      },
      {
        type : 'step', 
        expression : ['/',['to-number',['get', `ind_80p_${year}`]],['to-number',['get',`ind_${year}`]]],
        cols : colorbrewer["PuOr"][8],
        name:"80p",
        denom:"ind",
        year:year,
        visibility:'visible',
        text:"Plus de 80 ans",
        unit:'%',
        format:function(d){return Math.round(d*1000)/10},
        group:'pop'
      }


])).flat()